
#include <event2/event.h>
#include <event2/http.h>
#include <event2/http_struct.h>
#include <event2/rpc.h>
#include <event2/rpc_struct.h>

#include "rack.gen.h"

EVRPC_HEADER(RequestVote, request_vote_request, request_vote_response)
EVRPC_GENERATE(RequestVote, request_vote_request, request_vote_response)

int main( int argc, char * argv[] ) {

  struct event_base * base;
  struct evhttp * http;

  int port = 1979;
  char const * host = "127.0.0.1";

  signal(SIGPIPE, SIG_IGN);

  base = event_base_new();
  http = evhttp_new(base);
  evhttp_bind_socket_with_handle(http, host, port);

  struct evrpc_base * rpc_base;
  rpc_base = evrpc_init(http);

  EVRPC_REGISTER(rpc_base, RequestVote, request_vote_request, request_vote_response, request_vote_cb, NULL);

  event_dispatch();
}
